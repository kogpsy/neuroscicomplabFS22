
## -----------------------------------------------------------------------------------------------------------------
library(tidyverse)


## -----------------------------------------------------------------------------------------------------------------
d <- read_csv("data/session-7.csv")


## -----------------------------------------------------------------------------------------------------------------
glimpse(d)


## -----------------------------------------------------------------------------------------------------------------
d <- d |>
  pivot_longer(everything(),
               names_to = "group", values_to = "rt") |>
  mutate(group = as_factor(group)) |>
  arrange(group)


## -----------------------------------------------------------------------------------------------------------------
glimpse(d)


## -----------------------------------------------------------------------------------------------------------------
p1 <- d |>
  ggplot(aes(rt)) +
  geom_histogram(aes(y = ..density..),
                 colour = "black", fill = "white",
                 binwidth = 10) +
  geom_density(lwd = 1, colour = 4,
               fill = 4, alpha = 0.25) +
  facet_wrap(~group, ncol = 1) +
  xlab("Response time [ms]") +
  xlim(c(0, 2200))


## -----------------------------------------------------------------------------------------------------------------
p1


## -----------------------------------------------------------------------------------------------------------------
d %>%
  group_by(group) %>%
  summarise(mean = mean(rt),
            sd = sd(rt))


## -----------------------------------------------------------------------------------------------------------------
d %>%
  group_by(group) %>%
  summarise(mean = median(rt),
            q25 = quantile(rt, probs = 0.25),
            q75 = quantile(rt, probs = 0.75)) |>
  mutate(IQR = q75 - q25)


## -----------------------------------------------------------------------------------------------------------------
d %>%
  group_by(group) %>%
  summarise(mean = median(rt),
            IQR = IQR(rt))


## -----------------------------------------------------------------------------------------------------------------
funs <- list(mean = mean, median = median,
             sd = sd, IQR = IQR)

by_group <- d |>
  group_by(group) |>
  summarise(across(rt, funs, .names = "{.fn}")) |>
  mutate(across(where(is.numeric), ~round(., 2)))


## -----------------------------------------------------------------------------------------------------------------
by_group


## -----------------------------------------------------------------------------------------------------------------
p1 +
  geom_vline(aes(xintercept = mean),
             data = by_group,
             color = "steelblue",
             lwd = 1.5) +
  geom_vline(aes(xintercept = median),
             data = by_group,
             color = "red",
             lwd = 1.5)


## -----------------------------------------------------------------------------------------------------------------
deciles <- seq(0.1, 0.9, length.out = 9)


## -----------------------------------------------------------------------------------------------------------------
quantile_fun <- function(x, probs = c(0.25, 0.5, 0.75)) {
  tibble(rt = quantile(x, probs, type = 8), quantile = probs)
}


## -----------------------------------------------------------------------------------------------------------------
d_quantiles <- d %>%
  group_by(group) %>%
  summarise(quantile_fun(rt, probs = deciles))


## -----------------------------------------------------------------------------------------------------------------
d_quantiles


## -----------------------------------------------------------------------------------------------------------------
d_quantile_differences <- d_quantiles |>
  pivot_wider(names_from = "group", values_from = "rt")


## -----------------------------------------------------------------------------------------------------------------
d_quantile_differences


## -----------------------------------------------------------------------------------------------------------------
d_quantile_differences <- d_quantile_differences |>
    mutate(`control - adhd` = control - adhd)


## -----------------------------------------------------------------------------------------------------------------
d_quantile_differences


## -----------------------------------------------------------------------------------------------------------------
d_quantile_differences %>%
  ggplot(aes(x = control, y = `control - adhd`)) +
  geom_hline(yintercept = 0, linetype = 3) +
  geom_vline(xintercept = d_quantile_differences %>%
               filter(quantile == "50%") %>%
               select(adhd) %>%
               pull(), linetype = 3) +
  geom_line(aes(group = 1), color = "steelblue", size = 2) +
  geom_point(shape = 21, color = "steelblue", fill = "white", size = 5, stroke = 1) +
  coord_cartesian(ylim = c(-300, 300))


## install.packages("remotes")
## remotes::install_github("GRousselet/rogme")


## -----------------------------------------------------------------------------------------------------------------
# library(rogme)


## -----------------------------------------------------------------------------------------------------------------
out <- rogme::shifthd(d, rt ~ group)


## -----------------------------------------------------------------------------------------------------------------
rogme::plot_sf(out)

